<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Let’s Go Create V2 — Server Status</title>
  <style>
    :root {
      --bg: #0e1117;
      --fg: #e6edf3;
      --muted: #9da9b5;
      --card: #161b22;
      --ok: #2ea04320;
      --ok-border: #2ea043;
      --warn: #bb800920;
      --warn-border: #bb8009;
      --err: #f8514920;
      --err-border: #f85149;
      --badge: #30363d;
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; background: var(--bg); color: var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; }
    .container { max-width: 760px; margin: 40px auto; padding: 0 16px; }
    h1 { font-weight: 800; margin-bottom: 16px; letter-spacing: .3px; }

    .card { background: var(--card); border: 1px solid #30363d; border-radius: var(--radius); padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .card.ok   { border-color: var(--ok-border);   box-shadow: 0 10px 30px var(--ok); }
    .card.warn { border-color: var(--warn-border); box-shadow: 0 10px 30px var(--warn); }
    .card.err  { border-color: var(--err-border);  box-shadow: 0 10px 30px var(--err); }

    .row { display: flex; align-items: center; gap: 12px; margin: 10px 0; }
    .label { width: 120px; color: var(--muted); }
    .badge { background: var(--badge); border: 1px solid #30363d; padding: 4px 10px; border-radius: 999px; font-weight: 700; text-transform: uppercase; font-size: 12px; }
    .badge.ok { border-color: var(--ok-border); color: #69d27d; }
    .badge.warn { border-color: var(--warn-border); color: #ebb678; }
    .badge.err { border-color: var(--err-border); color: #ff9b95; }

    .foot { margin-top: 12px; color: var(--muted); font-size: 12px; display:flex; justify-content: space-between; align-items:center; gap:8px; flex-wrap: wrap; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    a { color: #8ab4ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <main class="container">
    <h1>Let’s Go Create V2 — Server Status</h1>

    <section class="card" id="status-card">
      <div class="row">
        <span class="label">Status:</span>
        <span id="state" class="badge">Checking…</span>
      </div>
      <div class="row">
        <span class="label">MOTD:</span>
        <span id="motd">—</span>
      </div>
      <div class="row">
        <span class="label">Players:</span>
        <span id="players">—</span>
      </div>
      <div class="row">
        <span class="label">Version:</span>
        <span id="version">—</span>
      </div>
      <div class="row">
        <span class="label">Ping:</span>
        <span id="ping">—</span>
      </div>
      <div class="foot">
        <span id="updated">Last updated: —</span>
        <span class="mono">Path: /mc_status</span>
      </div>
    </section>
  </main>

  <script type="module">
    // ——— Firebase web config (your values) ———
    const firebaseConfig = {
      apiKey: "AIzaSyArccJnD2qGe8ty503oBv0SQ772dUVEvbk",
      authDomain: "letsgocreatev2.firebaseapp.com",
      databaseURL: "https://letsgocreatev2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "letsgocreatev2",
      storageBucket: "letsgocreatev2.firebasestorage.app",
      messagingSenderId: "226793735098",
      appId: "1:226793735098:web:4f06f0d316d3cc62955383"
    };

    // Modular Firebase SDK (v9+) — import only what we need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Bind elements
    const elState   = document.getElementById("state");
    const elMotd    = document.getElementById("motd");
    const elPlayers = document.getElementById("players");
    const elVersion = document.getElementById("version");
    const elPing    = document.getElementById("ping");
    const elUpdated = document.getElementById("updated");
    const card      = document.getElementById("status-card");

    // Helpers
    const fmtTime = (ts) => {
      if (!ts) return "—";
      const d = new Date(ts * 1000);
      return d.toLocaleString();
    };

    function applyStateStyle(state) {
      elState.textContent = state ?? "unknown";
      elState.className = "badge"; // reset
      card.className = "card";     // reset

      switch ((state || "").toLowerCase()) {
        case "online":
          elState.classList.add("ok");
          card.classList.add("ok");
          break;
        case "starting":
        case "stopping":
          elState.classList.add("warn");
          card.classList.add("warn");
          break;
        case "offline":
        default:
          elState.classList.add("err");
          card.classList.add("err");
      }
    }

    // Live listener on /mc_status
    onValue(ref(db, "mc_status"), (snap) => {
      const v = snap.val() || {};
      applyStateStyle(v.state);
      elMotd.textContent = v.motd ?? "—";
      const pOn = (v.players_online ?? "—");
      const pMax = (v.players_max ?? "—");
      elPlayers.textContent = `${pOn} / ${pMax}`;
      elVersion.textContent = v.version ?? "—";
      elPing.textContent = (v.ping_ms != null) ? `${v.ping_ms} ms` : "—";
      elUpdated.textContent = `Last updated: ${fmtTime(v.last_updated)}`;
    }, (err) => {
      // If DB read fails, show offline-ish state
      applyStateStyle("offline");
      elMotd.textContent = "Error loading status";
      console.error(err);
    });
  </script>
</body>
</html>
