<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Let’s Go Create V2 — Minecraft Server</title>
  <meta name="description" content="Let’s Go Create V2 — live status, how to join, modpack download, and Discord." />
  <meta name="theme-color" content="#2ea043" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <!--
    Firebase data shape:
    {
      "Status": { "Lockdown":false, "Maintenance":false, "WhitelistOnly":false, "EventLive":false, "Emergency":false },
      "mc_status": { "state":"online|offline|starting|stopping", "last_updated": 0, "players_online":0, "players_max":0, "version":"1.20.1", "ping_ms":0, "motd":"§a..." }
    }
  -->
  <style>
    :root { --bg:#0b0f14; --panel:#0f1620; --card:#121a25; --border:#233142; --fg:#e6edf3; --muted:#a7b1bd; --brand:#67e8f9; --accent:#2ea043; --accent-2:#8b5cf6; --ok:#2ea043; --warn:#bb8009; --err:#f85149; --shadow:0 12px 40px rgba(0,0,0,.35); --radius:16px; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(1200px 600px at 20% -10%,#0f1b2a 0%,transparent 60%),radial-gradient(1000px 600px at 120% 20%,#131f2f 0%,transparent 50%),var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    a{color:#8ab4ff;text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;backdrop-filter:blur(8px);background:rgba(11,15,20,.6);border-bottom:1px solid rgba(255,255,255,.06);z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .brand .logo{width:28px;height:28px;border-radius:8px;background:url('https://file.garden/aACuwggY3QmuIi9B/server-icon.png') center/cover no-repeat;box-shadow:0 6px 20px rgba(103,232,249,.35)}
    .brand span{font-size:18px}
    .menu{display:flex;gap:14px;flex-wrap:wrap}
    .menu a{color:var(--muted);font-weight:600}
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:22px;align-items:stretch;margin-top:26px}
    @media(max-width:900px){.hero{grid-template-columns:1fr}}
    .hero .pitch{background:linear-gradient(180deg,rgba(103,232,249,.08),rgba(103,232,249,0));border:1px solid var(--border);border-radius:var(--radius);padding:26px;box-shadow:var(--shadow)}
    .kicker{color:var(--brand);font-weight:800;letter-spacing:.2em;text-transform:uppercase;font-size:12px}
    h1{font-size:34px;margin:8px 0 10px 0}
    p.lead{color:var(--muted);font-size:16px;line-height:1.5}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#0e151f,#0c121a);color:var(--fg);font-weight:700;box-shadow:var(--shadow);cursor:pointer}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(180deg,#193c2b,#13291e);border-color:#1f4d33}
    .btn .dot{width:8px;height:8px;border-radius:999px;background:var(--brand)}
    .status{background:linear-gradient(180deg,rgba(139,92,246,.08),rgba(139,92,246,0));border:1px solid var(--border);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow)}
    .rows{display:grid;gap:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .label{color:var(--muted)} .value{font-weight:800}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0c121a;text-transform:uppercase;font-weight:800;font-size:12px;letter-spacing:.06em}
    .badge.ok{color:var(--ok);border-color:rgba(46,160,67,.5)} .badge.warn{color:var(--warn);border-color:rgba(187,128,9,.5)} .badge.err{color:var(--err);border-color:rgba(248,81,73,.5)}
    .note{margin-top:8px;color:var(--muted);font-size:12px;line-height:1.4}
    section{margin-top:38px} h2{font-size:22px;margin:0 0 14px 0}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px} @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    footer{margin-top:40px;border-top:1px solid var(--border);padding:22px 0;color:var(--muted);font-size:13px}

    /* Override banner */
    .override{position:sticky;top:56px;z-index:20;margin:12px 0;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:#111827;display:none;align-items:center;gap:10px;font-weight:800;letter-spacing:.05em;text-transform:uppercase;box-shadow:var(--shadow)}
    .override.show{display:flex}
    .override.ok{border-color:rgba(46,160,67,.5)}
    .override.warn{border-color:rgba(187,128,9,.5)}
    .override.err{border-color:rgba(248,81,73,.5)}
    .override .pill{padding:4px 10px;border-radius:999px;border:1px solid var(--border)}
    .override.ok .pill{color:var(--ok)}
    .override.warn .pill{color:var(--warn)}
    .override.err .pill{color:var(--err)}
    .override .desc{font-weight:600;color:var(--muted);text-transform:none;letter-spacing:0}
    .error-big{position:sticky;top:56px;z-index:25;margin:12px 0;padding:14px 16px;border-radius:12px;border:2px dashed rgba(248,81,73,.6);background:#1a0f12;color:#ffd2d2;font-weight:900;display:none}
    .error-big.show{display:block}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><div class="logo"></div><span>Let’s Go Create V2</span></div>
      <nav class="menu">
        <a href="#status">Status</a>
        <a href="#join">Join</a>
        <a href="#mods">Modpack</a>
        <a href="#about">About</a>
        <a href="#rules">Rules & Systems</a>
        <a href="https://discord.gg/vGk4kKfQrj" target="_blank" rel="noopener">Discord</a>
        <a href="#faq">FAQ</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div id="override-error" class="error-big">STATUS ERROR — Multiple overrides active. Fix toggles in Firebase.</div>
    <div id="override-banner" class="override"><span class="pill" id="override-label"></span><span class="desc" id="override-desc"></span></div>

    <div class="hero" id="top">
      <div class="pitch">
        <div class="kicker">Let’s Go Create V2</div>
        <h1>A living world with laws, trials, government & economy.</h1>
        <p class="lead">Join a highly organized survival server where players help shape the society.</p>
        <div class="cta">
          <button class="btn primary" id="copy-ip"><span class="dot"></span> Copy Server Address</button>
          <a class="btn" id="mods-link" href="https://mega.nz/folder/n4ohwLoT#nZmVoc55DjgOZPodBekirA" target="_blank" rel="noopener">Download Modpack</a>
          <a class="btn" href="https://discord.gg/vGk4kKfQrj" target="_blank" rel="noopener">Join Discord</a>
        </div>
        <div style="margin-top:10px;color:var(--muted);font-size:13px">Address: <span class="badge" id="server-address">known-resorts.gl.joinmc.link</span></div>
      </div>

      <aside class="status" id="status">
        <div class="row" style="margin-bottom:8px"><span class="label">Server Status</span><span class="badge" id="state">LOADING</span></div>
        <div class="rows">
          <div class="row"><span class="label">MOTD</span><span class="value" id="motd">—</span></div>
          <div class="row"><span class="label">Players</span><span class="value" id="players">—</span></div>
          <div class="row"><span class="label">Version</span><span class="value" id="version">—</span></div>
          <div class="row"><span class="label">Ping</span><span class="value" id="ping">—</span></div>
        </div>
        <div class="row" style="margin-top:12px"><span class="label">Updated</span><span class="value" id="updated">—</span></div>
        <div class="note" id="status-note">Current status is <strong>LOADING</strong>. If you see this over 5 seconds, refresh the page or contact us on Discord.</div>
      </aside>
    </div>

    <footer>
      <div class="row" style="justify-content:space-between">
        <div>© 2025 Let’s Go Create V2. All rights reserved.</div>
        <div>Live data from Firebase Realtime Database.</div>
      </div>
    </footer>
  </main>

  <audio id="online-snd" src="https://file.garden/aACuwggY3QmuIi9B/aternos-sound.mp3" preload="auto"></audio>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyArccJnD2qGe8ty503oBv0SQ772dUVEvbk",
      authDomain: "letsgocreatev2.firebaseapp.com",
      databaseURL: "https://letsgocreatev2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "letsgocreatev2",
      storageBucket: "letsgocreatev2.firebasestorage.app",
      messagingSenderId: "226793735098",
      appId: "1:226793735098:web:4f06f0d316d3cc62955383"
    };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, onValue, get } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // Elements
    const elState   = document.getElementById('state');
    const elMotd    = document.getElementById('motd');
    const elPlayers = document.getElementById('players');
    const elVersion = document.getElementById('version');
    const elPing    = document.getElementById('ping');
    const elUpdated = document.getElementById('updated');
    const elNote    = document.getElementById('status-note');
    const card      = document.getElementById('status');

    // Override banner
    const ovBanner = document.getElementById('override-banner');
    const ovLabel  = document.getElementById('override-label');
    const ovDesc   = document.getElementById('override-desc');
    const ovError  = document.getElementById('override-error');

    // Copy IP
    document.getElementById('copy-ip').addEventListener('click', async (e) => {
      try { await navigator.clipboard.writeText('known-resorts.gl.joinmc.link'); flash(e.target, 'Copied!'); }
      catch { flash(e.target, 'Copy failed'); }
    });
    function flash(btn, txt){ const prev = btn.textContent; btn.textContent = txt; setTimeout(()=>btn.textContent = prev, 900); }

    // Helpers
    const STALE_SECONDS = 60; // monitor considered OFF if older than this
    function isStale(ts){ return !ts || (Math.floor(Date.now()/1000) - ts) > STALE_SECONDS; }
    function stripMinecraftCodes(s){ if(!s) return '—'; return s.replace(/§[0-9A-FK-OR]/gi, ''); }

    function setBadge(label, cls){ elState.textContent = label; elState.className = 'badge ' + cls; card.className = 'status ' + cls; }

    function setStateBadge(state, stale){
      const s = (state||'').toLowerCase();
      if (stale) { setBadge('OFF', 'err'); return; } // monitor OFF
      if (s === 'online') { setBadge('ONLINE', 'ok'); return; }
      if (s === 'starting' || s === 'stopping') { setBadge('STARTING/STOPPING', 'warn'); return; }
      if (s === 'offline') { setBadge('OFFLINE', 'err'); return; } // server offline, monitor alive
      setBadge('LOADING', 'warn');
    }

    // Override map & truthiness helper
    const OV_MAP = {
      Lockdown:      { label: 'LOCKDOWN',      cls: 'err',  desc: 'Restricted access — admins only.' },
      Maintenance:   { label: 'MAINTENANCE',   cls: 'warn', desc: 'Updates in progress; expect restarts.' },
      WhitelistOnly: { label: 'WHITELIST ONLY',cls: 'warn', desc: 'Only approved players may join.' },
      EventLive:     { label: 'EVENT LIVE',     cls: 'ok',   desc: 'Special event is active!' },
      Emergency:     { label: 'EMERGENCY',      cls: 'err',  desc: 'Emergency issue — check Discord.' }
    };
    const isTrue = (v)=> v === true || v === 'true' || v === 1 || v === '1';

    // Audio
    const onlineSnd = document.getElementById('online-snd');
    let audioUnlocked = false; let lastSoundMs = 0; let prevState = 'loading';
    addEventListener('click', () => {
      if (audioUnlocked) return;
      onlineSnd.play().then(() => { onlineSnd.pause(); onlineSnd.currentTime = 0; audioUnlocked = true; }).catch(()=>{});
    }, { once:true });

    let overrideInfo = null; // currently applied override
    function applyOverrideUI(m){
      if (!m) { ovBanner.classList.remove('show','ok','warn','err'); ovError.classList.remove('show'); overrideInfo = null; return; }
      ovLabel.textContent = m.label; ovDesc.textContent = m.desc; ovBanner.className = 'override show ' + m.cls; overrideInfo = m;
      setBadge(m.label, m.cls); elNote.textContent = m.desc;
    }

    function recomputeOverride(raw){
      const active = Object.entries(raw||{}) .filter(([k,v])=> isTrue(v)).map(([k])=>k);
      if (active.length > 1) { ovError.classList.add('show'); applyOverrideUI({ label:'STATUS ERROR', cls:'err', desc:'Multiple overrides enabled' }); return; }
      ovError.classList.remove('show');
      if (active.length === 1) { const key = active[0]; applyOverrideUI(OV_MAP[key] || { label:key.toUpperCase(), cls:'warn', desc:'Special mode active.' }); }
      else { applyOverrideUI(null); }
    }

    // Attach listeners (and allow re-attach on resume/online)
    let unsubStatus = null, unsubMc = null;
    function attach(){
      if (unsubStatus) unsubStatus(); if (unsubMc) unsubMc();
      unsubStatus = onValue(ref(db,'Status'), (snap)=>{ console.log('[Status]',snap.val()); recomputeOverride(snap.val()); }, (e)=>console.error('Status listener error', e));
      unsubMc = onValue(ref(db,'mc_status'), (snap)=>{ const v=snap.val()||{}; const stale=isStale(v.last_updated); const state=(v.state||'loading').toLowerCase();
        // Update fields
        elMotd.textContent = stripMinecraftCodes(v.motd);
        elPlayers.textContent = `${v.players_online ?? '—'} / ${v.players_max ?? '—'}`;
        elVersion.textContent = v.version ?? '—';
        elPing.textContent = (v.ping_ms!=null)? `${v.ping_ms} ms` : '—';
        elUpdated.textContent = v.last_updated? new Date(v.last_updated*1000).toLocaleString() : '—';
        if (!overrideInfo) {
          setStateBadge(state, stale);
          if (stale) { elNote.textContent = 'Monitor is OFF — this PC is not 24/7. Server likely fully OFF.'; }
          else if (state==='online') { elNote.textContent = 'Server is ONLINE. If you still can’t join, wait a minute or check our Discord for updates.'; }
          else if (state==='offline') { elNote.textContent = 'Server is OFFLINE (monitor alive) — could be maintenance, backups, or a restart.'; }
          else if (state==='starting' || state==='stopping') { elNote.textContent = 'Status: STARTING/STOPPING — please wait, this can take a minute.'; }
          else { elNote.textContent = 'Current status is LOADING. If you see this for over 5 seconds, refresh or check Discord.'; }
        }
        // Sound on transition to ONLINE (only when not overridden and not stale)
        if (!overrideInfo && !stale && prevState!=='online' && state==='online' && audioUnlocked) {
          const nowMs=Date.now(); if (nowMs-lastSoundMs>15000){ try{ onlineSnd.currentTime=0; onlineSnd.play(); lastSoundMs=nowMs; }catch(e){} }
        }
        prevState = state;
      }, (e)=>console.error('mc_status listener error',e));
    }

    attach();

    // Background → foreground or network back online: force a refresh read (keeps live feel)
    document.addEventListener('visibilitychange', async ()=>{ if (document.visibilityState==='visible'){ attach(); await hardRefreshRead(); }});
    window.addEventListener('online', async ()=>{ attach(); await hardRefreshRead(); });

    // Periodic hard refresh (poll) as a safety net in case WebSocket drops silently
    async function hardRefreshRead(){
      try {
        const [s1, s2] = await Promise.all([ get(ref(db,'Status')), get(ref(db,'mc_status')) ]);
        recomputeOverride(s1.val());
        const v=s2.val()||{}; const stale=isStale(v.last_updated); const state=(v.state||'loading').toLowerCase();
        elMotd.textContent = stripMinecraftCodes(v.motd);
        elPlayers.textContent = `${v.players_online ?? '—'} / ${v.players_max ?? '—'}`;
        elVersion.textContent = v.version ?? '—';
        elPing.textContent = (v.ping_ms!=null)? `${v.ping_ms} ms` : '—';
        elUpdated.textContent = v.last_updated? new Date(v.last_updated*1000).toLocaleString() : '—';
        if (!overrideInfo) setStateBadge(state, stale);
      } catch(e){ console.error('Hard refresh failed', e); }
    }
    setInterval(hardRefreshRead, 20000); // every 20s

    // Loading reminder
    setTimeout(()=>{ if (elState.textContent==='LOADING' && !overrideInfo) elNote.textContent='Current status is LOADING. If you see this over 5 seconds, refresh the page or contact us on Discord.'; }, 5000);
  </script>
</body>
</html>
