<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Let’s Go Create V2 — Minecraft Server</title>
  <meta name="description" content="Let’s Go Create V2 — live status, how to join, modpack download, and Discord." />
  <meta name="theme-color" content="#2ea043" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>
    :root{
      --bg:#0b0f14;--panel:#0f1620;--card:#121a25;--border:#233142;--fg:#e6edf3;--muted:#a7b1bd;
      --brand:#67e8f9;--accent:#2ea043;--ok:#2ea043;--warn:#bb8009;--err:#f85149;
      --shadow:0 16px 60px rgba(0,0,0,.45);--radius:18px
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(1400px 700px at 20% -10%,#0f1b2a 0%,transparent 60%),radial-gradient(1200px 700px at 120% 20%,#131f2f 0%,transparent 50%),var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji")}
    .wrap{max-width:1280px;margin:0 auto;padding:28px}
    header{position:sticky;top:0;backdrop-filter:blur(10px);background:rgba(11,15,20,.6);border-bottom:1px solid rgba(255,255,255,.06);z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:18px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;letter-spacing:.3px;font-size:22px}
    .brand .logo{width:32px;height:32px;border-radius:10px;background:url('https://file.garden/aACuwggY3QmuIi9B/server-icon.png') center/cover no-repeat;box-shadow:0 6px 20px rgba(103,232,249,.35)}
    .menu{display:flex;gap:18px;flex-wrap:wrap}
    .menu a{color:var(--muted);font-weight:600;font-size:16px;text-decoration:none}
    .menu a:hover{text-decoration:underline}

    .hero{display:grid;grid-template-columns:1.25fr .75fr;gap:26px;align-items:stretch;margin-top:30px}
    @media(max-width:1000px){.hero{grid-template-columns:1fr}}
    .pitch{background:linear-gradient(180deg,rgba(103,232,249,.08),rgba(103,232,249,0));border:1px solid var(--border);border-radius:var(--radius);padding:30px;box-shadow:var(--shadow)}
    .kicker{color:var(--brand);font-weight:800;letter-spacing:.22em;text-transform:uppercase;font-size:13px}
    h1{font-size:40px;margin:10px 0 12px 0}
    p.lead{color:var(--muted);font-size:18px;line-height:1.6}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:14px 16px;border-radius:14px;border:1px solid var(--border);background:linear-gradient(180deg,#0e151f,#0c121a);color:var(--fg);font-weight:800;box-shadow:var(--shadow);cursor:pointer;font-size:15px}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(180deg,#1a3f2c,#13291e);border-color:#1f4d33}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .badge{display:inline-flex;align-items:center;gap:10px;padding:7px 12px;border:1px solid var(--border);border-radius:999px;background:#0c121a;text-transform:uppercase;font-weight:900;font-size:13px;letter-spacing:.06em}
    .status{background:linear-gradient(180deg,rgba(139,92,246,.08),rgba(139,92,246,0));border:1px solid var(--border);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow)}
    .rows{display:grid;gap:13px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;font-size:16px}
    .label{color:var(--muted)} .value{font-weight:900}
    .badge.ok{color:var(--ok);border-color:rgba(46,160,67,.5)} .badge.warn{color:var(--warn);border-color:rgba(187,128,9,.5)} .badge.err{color:var(--err);border-color:rgba(248,81,73,.5)}
    .note{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.5}
    section{margin-top:42px} h2{font-size:24px;margin:0 0 16px 0}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px} @media(max-width:1000px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);font-size:16px}
    footer{margin-top:44px;border-top:1px solid var(--border);padding:24px 0;color:var(--muted);font-size:14px}

    .override{position:sticky;top:64px;z-index:20;margin:12px 0;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:#111827;display:none;align-items:center;gap:10px;font-weight:800;letter-spacing:.05em;text-transform:uppercase;box-shadow:var(--shadow)}
    .override.show{display:flex}
    .override.ok{border-color:rgba(46,160,67,.5)}
    .override.warn{border-color:rgba(187,128,9,.5)}
    .override.err{border-color:rgba(248,81,73,.5)}
    .override .pill{padding:4px 10px;border-radius:999px;border:1px solid var(--border)}
    .override.ok .pill{color:var(--ok)}
    .override.warn .pill{color:var(--warn)}
    .override.err .pill{color:var(--err)}
    .override .desc{font-weight:600;color:var(--muted);text-transform:none;letter-spacing:0}
    .error-big{position:sticky;top:64px;z-index:25;margin:12px 0;padding:14px 16px;border-radius:12px;border:2px dashed rgba(248,81,73,.6);background:#1a0f12;color:#ffd2d2;font-weight:900;display:none}
    .error-big.show{display:block}

    .toast{position:fixed;right:20px;bottom:20px;background:#0f1620;border:1px solid var(--border);padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);display:none}
    .toast.show{display:block}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><div class="logo"></div><span>Let’s Go Create V2</span></div>
      <nav class="menu">
        <a href="#status">Status</a><a href="#join">Join</a><a href="#mods">Modpack</a>
        <a href="#about">About</a><a href="#rules">Rules & Systems</a><a href="#faq">FAQ</a>
        <a href="https://discord.gg/vGk4kKfQrj" target="_blank" rel="noopener">Discord</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div id="override-error" class="error-big">STATUS ERROR — Multiple overrides active. Fix toggles in Firebase.</div>
    <div id="override-banner" class="override"><span class="pill" id="override-label"></span><span class="desc" id="override-desc"></span></div>

    <div class="hero" id="top">
      <div class="pitch">
        <div class="kicker">Let’s Go Create V2</div>
        <h1>A living world with laws, trials, government & economy.</h1>
        <p class="lead">Join a highly organized survival server where players help shape the society: court trials, ethics oversight, petitions, elections, and more.</p>
        <div class="cta">
          <button class="btn primary" id="copy-ip"><span class="dot"></span> Copy Server Address</button>
          <a class="btn" id="mods-link" href="https://mega.nz/folder/n4ohwLoT#nZmVoc55DjgOZPodBekirA" target="_blank" rel="noopener">Download Modpack</a>
          <a class="btn" href="https://discord.gg/vGk4kKfQrj" target="_blank" rel="noopener">Join Discord</a>
          <button class="btn" id="request-start" title="Ask admins to start the server">Request Server Start</button>
        </div>
        <div style="margin-top:12px;color:var(--muted);font-size:14px">Address: <span class="badge" id="server-address">known-resorts.gl.joinmc.link</span></div>
        <div id="cooldown-tip" class="note"></div>
      </div>

      <aside class="status" id="status">
        <div class="row" style="margin-bottom:10px"><span class="label">Server Status</span><span class="badge" id="state">LOADING</span></div>
        <div class="rows">
          <div class="row"><span class="label">MOTD</span><span class="value" id="motd">—</span></div>
          <div class="row"><span class="label">Players</span><span class="value" id="players">—</span></div>
          <div class="row"><span class="label">Version</span><span class="value" id="version">—</span></div>
          <div class="row"><span class="label">Ping</span><span class="value" id="ping">—</span></div>
        </div>
        <div class="row" style="margin-top:12px"><span class="label">Updated</span><span class="value" id="updated">—</span></div>
        <div class="note" id="status-note">Current status is <strong>LOADING</strong>. If you see this over 5 seconds, refresh or contact us on Discord.</div>
      </aside>
    </div>

    <!-- (About/Join/Mods/Rules/FAQ sections unchanged for brevity in this snippet) -->
  </main>

  <div id="toast" class="toast"></div>
  <audio id="online-snd" src="https://file.garden/aACuwggY3QmuIi9B/aternos-sound.mp3" preload="auto"></audio>

  <script type="module">
    // ==== CONFIG ====
    const DISCORD_WEBHOOK = "REPLACE_WITH_YOUR_DISCORD_WEBHOOK_URL";

    const firebaseConfig = {
      apiKey: "AIzaSyArccJnD2qGe8ty503oBv0SQ772dUVEvbk",
      authDomain: "letsgocreatev2.firebaseapp.com",
      databaseURL: "https://letsgocreatev2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "letsgocreatev2",
      storageBucket: "letsgocreatev2.firebasestorage.app",
      messagingSenderId: "226793735098",
      appId: "1:226793735098:web:4f06f0d316d3cc62955383"
    };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, onValue, get, set, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // ---- UI refs
    const elState   = document.getElementById('state');
    const elMotd    = document.getElementById('motd');
    const elPlayers = document.getElementById('players');
    const elVersion = document.getElementById('version');
    const elPing    = document.getElementById('ping');
    const elUpdated = document.getElementById('updated');
    const elNote    = document.getElementById('status-note');
    const card      = document.getElementById('status');
    const serverAddr= document.getElementById('server-address');
    const btnStart  = document.getElementById('request-start');
    const tipCd     = document.getElementById('cooldown-tip');
    const toastEl   = document.getElementById('toast');

    // Copy IP
    document.getElementById('copy-ip').addEventListener('click', async (e) => {
      try { await navigator.clipboard.writeText(serverAddr.textContent.trim()); toast('Copied server address'); }
      catch { toast('Copy failed'); }
    });

    // Helpers
    const STALE_SECONDS = 60;
    const isStale = (ts)=> !ts || (Math.floor(Date.now()/1000)-ts) > STALE_SECONDS;
    const stripMC = (s)=> s ? s.replace(/§[0-9A-FK-OR]/gi,'') : '—';
    function setBadge(label, cls){ elState.textContent = label; elState.className = 'badge ' + cls; card.className = 'status ' + cls; }
    function toast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 2500); }
    function fmtLeft(ms){ const s=Math.ceil(ms/1000); const m=Math.floor(s/60), r=s%60; return m? `${m}m ${r}s` : `${r}s`; }

    // Sound once when going ONLINE
    const onlineSnd = document.getElementById('online-snd'); let audioUnlocked=false, lastSoundMs=0, prevState='loading';
    addEventListener('click', () => {
      if (audioUnlocked) return;
      onlineSnd.play().then(()=>{ onlineSnd.pause(); onlineSnd.currentTime=0; audioUnlocked=true; }).catch(()=>{});
    }, { once:true });

    // ---- Live status
    onValue(ref(db,'mc_status'), (snap)=>{
      const v=snap.val()||{};
      const stale=isStale(v.last_updated);
      const state=(v.state||'loading').toLowerCase();

      elMotd.textContent = stripMC(v.motd);
      elPlayers.textContent = `${v.players_online ?? '—'} / ${v.players_max ?? '—'}`;
      elVersion.textContent = v.version ?? '—';
      elPing.textContent    = (v.ping_ms!=null)? `${v.ping_ms} ms` : '—';
      elUpdated.textContent = v.last_updated? new Date(v.last_updated*1000).toLocaleString() : '—';

      if (stale) { setBadge('OFF', 'err'); elNote.textContent='Server is fully OFF — this server is not 24/7.'; }
      else if (state==='online'){ setBadge('ONLINE','ok'); elNote.textContent='Server is ONLINE. If you still can’t join, wait a minute or check Discord.'; }
      else if (state==='offline'){ setBadge('OFFLINE','err'); elNote.textContent='Server is OFFLINE (system alive) — could be maintenance or restart.'; }
      else if (state==='starting'||state==='stopping'){ setBadge('STARTING/STOPPING','warn'); elNote.textContent='Please wait, this can take some time.'; }
      else { setBadge('LOADING','warn'); elNote.textContent='Loading… if this stays, refresh the page.'; }

      // Enable/disable request button if ONLINE
      btnStart.disabled = (state==='online' && !stale);
    });

    // ---- Cooldown reading (public config + last request)
    let COOLDOWN_MS = 300000; // fallback 5 min
    async function readCooldownMs(){
      try{
        const s = await get(ref(db,'/public/requestCooldownMs'));
        if (s.exists() && typeof s.val() === 'number') COOLDOWN_MS = s.val();
      }catch(e){ /* keep default */ }
    }
    await readCooldownMs();

    let lastRequestedAt = 0, countdownTimer=null;
    function setCountdown(msLeft){
      clearInterval(countdownTimer);
      if (msLeft <= 0){ tipCd.textContent=''; btnStart.disabled=false; return; }
      btnStart.disabled=true;
      tipCd.textContent = `Startup request cooldown active: ${fmtLeft(msLeft)} left.`;
      countdownTimer = setInterval(()=>{
        const left = (lastRequestedAt + COOLDOWN_MS) - Date.now();
        if (left <= 0){ clearInterval(countdownTimer); tipCd.textContent=''; btnStart.disabled=false; }
        else { tipCd.textContent = `Startup request cooldown active: ${fmtLeft(left)} left.`; }
      }, 1000);
    }

    onValue(ref(db,'/requests/start/lastRequestedAt'), (snap)=>{
      const ts = Number(snap.val()||0);
      if (!ts) { lastRequestedAt = 0; setCountdown(0); return; }
      lastRequestedAt = ts;
      const left = (ts + COOLDOWN_MS) - Date.now();
      setCountdown(left);
    });

    // ---- Request button handler (rate-limited by DB rules)
    btnStart.addEventListener('click', async ()=>{
      try{
        // 1) Try to write server-checked timestamp (DB rules enforce 5 min + near-now)
        const now = Date.now();
        await set(ref(db,'/requests/start/lastRequestedAt'), now);

        // 2) Notify Discord (best-effort)
        const content = `🔔 **Startup requested** — ${new Date().toLocaleString()}  \nIP: \`${serverAddr.textContent.trim()}\``;
        fetch(DISCORD_WEBHOOK, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ content, allowed_mentions:{ parse:[] } })
        }).catch(()=>{ /* ignore */ });

        // 3) UI feedback
        toast('Request sent. We’ll spin it up!');
        setCountdown(COOLDOWN_MS);
      }catch(e){
        console.error(e);
        toast('Request failed. Try again later.');
      }
    });
  </script>
</body>
</html>
